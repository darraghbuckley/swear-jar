<!DOCTYPE html>
<html>
  <head>
    <link
      crossorigin='anonymous'
      href='https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css'
      integrity='sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk'
      rel='stylesheet'
    />
    <meta charset='utf-8' />
    <meta
      content='width=device-width, initial-scale=1, shrink-to-fit=no'
      name='viewport'
    />
    <title>Swear Jar</title>
  </head>
  <body>
    <div class='modal-backdrop fade show'></div>
    <div class='modal in' tabindex='-1' role='dialog' style='display: block;'>
      <div class='modal-dialog'>
        <div class='modal-content'>
          <form action='/jar/swear' method='post'>
            <div class='modal-header'>
              <h5 class='modal-title'>Swear jar</h5>
            </div>
            <div class='modal-body'>
              <ul class='list-group'>
                <li class='list-group-item'>
                  <div class='media'>
                    <div class='media-body'>Bank acount</div>
                    <div class='media-body'>
                      <select class='custom-select' name='account_id'>
                      <% session[:accounts].each_with_index do |account, index| %>
                        <option
                          value='<%= account[:id] %>'
                          <%= 'selected' if session[:account_id] == account[:id]%>
                        >
                          <%= account[:name] %>
                          (<%=
                            format(
                              '%<value>.2f', 
                              value: account[:balance] / 100.0)
                          %>)
                        </option>
                      <% end %>
                      </select>
                    </div>
                  </div>
                </li>
                <%
                  if session[:swear_jar]
                %>
                  <li class='list-group-item'>
                    <div class='media'>
                      <div class='media-body'>Swear jar</div>
                      <div class='media-body'>
                        <%= session.dig(:swear_jar, :name) %>
                        (<%=
                        format(
                          '%<value>.2f',
                          value: session.dig(:swear_jar, :balance) / 100.0)
                        %>)
                      </div>
                    </div>
                  </li>
                <%                               
                  end
                %>
              </ul>
              <% if session[:show_confirmation_flash] %>
                <div
                  class='alert alert-warning alert-dismissible mt-3'
                  role='alert'
                >
                  Fined!
                  <button
                    aria-label='Close'
                    class='close'
                    data-dismiss='alert'
                    type='button'                    
                  >
                    <span aria-hidden='true'>&times;</span>
                  </button>
                </div>
              <% end %>
            </div>
            <div class='modal-footer'>
              <% if session[:swear_jar] %>
                <button type='submit' class='btn btn-primary'>
                  I swore...
                </button>
              <% else %>
                <div class='alert alert-warning' role='alert'>
                  <div>
                    It looks like you don't have a swear jar yet. Would
                    you like to create one?
                  </div>
                  <hr />
                  <button
                    aria-label='Yes'
                    class='btn btn-block btn-warning'
                    onclick='createSwearJar()'
                    type='button'
                  >
                    Yes!
                  </button>
                </div>
              <% end %>
            </div>
          </form>          
        </div>
      </div>
    </div>
    <script>
      function createSwearJar() {
        fetch('/jar', { method: 'POST' })
        console.log('creating!')
      }
    </script>
    <script
      crossorigin='anonymous'
      integrity='sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj'
      src='https://code.jquery.com/jquery-3.5.1.slim.min.js'
    ></script>
    <script
      crossorigin='anonymous'
      integrity='sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo'
      src='https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js'
    ></script>
    <script
      crossorigin='anonymous'
      integrity='sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI'
      src='https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js'
    ></script>
  </body>
</html>
